<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tsp.new_tsp_project.api.admin.portfolio.service.Impl.AdminPortFolioMapper">

	<!-- 포트폴리오 수 조회 -->
	<select id="getPortFolioCnt" parameterType="java.util.HashMap" resultType="Integer">
		/*[AdminPortFolioApi_SQL.xml].[getPortFolioCnt] */
		SELECT COUNT(*)
		FROM tsp_portFolio tp, tsp_image ti
		WHERE tp.idx = ti.type_idx
		AND ti.type_name = 'portFolio'
		AND tp.visible = 'Y'
	</select>

	<!-- 포트폴리오 리스트 출력 -->
	<select id="getPortFolioList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		/*[AdminPortFolioApi_SQL.xml].[getPortFolioList] */
		SELECT tp.idx,
			   tp.category_cd,
			   tp.category_nm,
			   tp.title,
			   tp.description,
			   tp.hash_tag,
			   tp.video_url,
			   file_mask,
			   file_path,
			   file_name
		FROM tsp_portFolio tp, tsp_image ti
		WHERE tp.idx = ti.type_idx
		  AND ti.type_name = 'portFolio'
		  AND tp.visible = 'Y'
			LIMIT #{startPage}, #{size}
	</select>

	<!-- 포트폴리오 상세 조회 -->
	<select id="getPortFolioInfo" parameterType="adminPortFolioDto" resultType="java.util.HashMap">
		/*[AdminPortFolioApi_SQL.xml].[getPortFolioInfo] */
		SELECT tp.idx,
			   tp.category_cd,
			   tp.category_nm,
			   tp.title,
			   tp.description,
			   tp.hash_tag,
			   tp.video_url,
			   file_mask,
			   file_path,
			   file_name
		FROM tsp_portFolio tp, tsp_image ti
		WHERE tp.idx = ti.type_idx
		  AND ti.type_name = 'portFolio'
		  AND tp.visible = 'Y'
		  AND tp.idx = #{idx}
	</select>

	<!-- 포트폴리오 등록 -->
	<insert id="insertPortFolio" parameterType="adminPortFolioDto" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO tsp_portFolio(title,
								  description,
								  hash_tag,
								  category_cd,
								  category_nm,
								  video_url,
								  visible,
								  creator,
								  create_time,
								  updater,
								  update_time)
		VALUES (#{title},
				#{description},
				#{hashTag},
				#{categoryCd},
				#{categoryNm},
				#{videoUrl},
				'Y',
				'1',
				now(),
				'1',
				now())
	</insert>

	<!-- 프로덕션 수정 -->
	<update id="updateProduction" parameterType="adminProductionDto">
		UPDATE tsp_production
		SET
		<if test="title != null and title != ''">title = #{title},</if>
		<if test="videoUrl != null and videoUrl != ''">video_url = #{videoUrl},</if>
		<if test="hashTag != null and hashTag != ''">hash_tag = #{hashTag},</if>
		<if test="categoryCd != null and categoryCd != ''">category_cd = #{categoryCd},</if>
		<if test="categoryNm != null and categoryNm != ''">category_nm = #{categoryNm},</if>
		<if test="description != null and description != ''">description = #{description},</if>
		<if test="visible != null and visible != ''">visible = #{visible},</if>
		<if test="updater != null and updater != ''">updater = #{updater},</if>
		update_time = NOW()
		WHERE idx = #{idx}
	</update>
</mapper>