<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tsp.new_tsp_project.api.admin.model.service.impl.AdminModelMapper">

<!--	<resultMap type="adminModelDto" id="modelResult">-->
<!--		<result column="idx" property="idx"/>-->
<!--		<result column="category_cd" property="categoryCd"/>-->
<!--		<result column="category_nm" property="categoryNm"/>-->
<!--		<result column="model_kor_name" property="modelKorName"/>-->
<!--		<result column="model_eng_name" property="modelEngName"/>-->
<!--		<result column="model_description" property="modelDescription"/>-->
<!--		<result column="visible" property="visible"/>-->
<!--		<result column="height" property="height"/>-->
<!--		<result column="size3" property="size3"/>-->
<!--		<result column="shoes" property="shoes"/>-->
<!--		<collection property="commonImageDTOList" column="type_idx" javaType="java.util.ArrayList" ofType="commonImageDto"-->
<!--					select="getImageList"/>-->
<!--	</resultMap>-->
	<!-- 모델 수 조회 -->
	<select id="getModelListCnt" parameterType="java.util.HashMap" resultType="Integer">
		/*[AdminModelApi_SQL.xml].[getModelListCnt] */
		SELECT COUNT(*)
		FROM tsp_model
		WHERE visible = 'Y'
	</select>

	<!-- 모델 리스트 출력 -->
	<select id="getModelList" parameterType="java.util.HashMap" resultType="adminModelDto">
		/*[AdminModelApi_SQL.xml].[getModelList] */
		SELECT tm.idx,
			   tm.category_cd,
			   tm.category_nm,
		       tm.category_age,
			   tm.model_kor_name,
			   tm.model_eng_name,
			   tm.model_description,
			   tm.visible,
			   tmo.height,
			   tmo.size3,
			   tmo.shoes,
		       tm.create_time
		FROM tsp_model tm,
			 tsp_model_opt tmo
		WHERE tm.idx = tmo.model_idx
		ORDER BY tm.idx ASC
			LIMIT #{startPage}, #{size}
	</select>

	<select id="getModelInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		/*[AdminModelApi_SQL.xml].[getModelInfo] */
		SELECT tm.idx,
			   tm.category_cd,
			   tm.category_nm,
		       tm.category_age,
			   tm.model_kor_name,
		       tm.model_eng_name,
			   tm.model_description,
			   tm.visible,
		       tmo.height,
		       tmo.size3,
		       tmo.shoes
		FROM tsp_model tm,
		     tsp_model_opt tmo
		WHERE tm.idx = tmo.model_idx
		  AND tm.visible = 'Y'
		  AND tm.idx = #{idx}
	</select>

	<select id="getImageList" parameterType="java.util.HashMap" resultType="commonImageDto">
		SELECT idx,
		       type_idx,
		       type_name,
		       file_num,
		       file_name,
		       file_size,
			   concat('/upload/',file_mask) AS file_mask,
		       file_path,
		       image_type,
		       reg_date
		FROM tsp_image
		WHERE type_name = 'model'
		AND type_idx = #{typeIdx}
		ORDER BY file_num ASC
	</select>

	<insert id="insertModel" parameterType="adminModelDto" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO tsp_model(category_cd,
							  category_nm,
		                      category_age,
							  model_kor_name,
		                      model_eng_name,
		                      model_description,
		                      visible,
							  creator,
							  create_time,
							  updater,
							  update_time)
		VALUES (#{categoryCd},
				#{categoryNm},
		        #{categoryAge},
				#{modelKorName},
				#{modelEngName},
		        #{modelDescription},
		        #{visible},
		        '1',
		        now(),
		        '1',
		        now())
	</insert>

	<update id="updateModel" parameterType="adminModelDto">
		UPDATE tsp_model
		SET
		<if test="model_kor_name != null and model_kor_name != ''">model_kor_name = #{modelKorName},</if>
		<if test="model_eng_name != null and model_eng_name != ''">model_eng_name = #{modelEngName},</if>
		<if test="model_description != null and model_description != ''">model_description = #{modelDescription},</if>
		<if test="updater != null and updater != ''">updater = #{updater},</if>
		update_time = NOW()
		WHERE idx = #{idx}
	</update>

	<insert id="insertModelOpt" parameterType="adminModelDto" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO tsp_model_opt(model_idx,
							  	  height,
								  size3,
		                          shoes,
		                          creator,
		                          create_time,
		                          updater,
		                          update_time)
		VALUES (#{modelIdx},
				#{height},
				#{size3},
				#{shoes},
				'1',
				now(),
				'1',
				now())
	</insert>

	<update id="updateModelOpt" parameterType="adminModelDto">
		UPDATE tsp_model_opt
		SET
		<if test="height != null and height != ''">height = #{height},</if>
		<if test="size3 != null and size3 != ''">size3 = #{size3},</if>
		<if test="shoes != null and shoes != ''">shoes = #{shoes},</if>
		<if test="updater != null and updater != ''">updater = #{updater},</if>
		update_time = NOW()
		WHERE idx = #{idx}
	</update>
</mapper>